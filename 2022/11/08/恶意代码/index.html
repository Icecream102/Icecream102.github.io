<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>恶意代码 | Luanne</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="[TOC] 一、基础知识1. 恶意代码定义malware is a set of instructions that run on your computer and make your system do something that an attacker wants it to do. 指令集合：二进制执行文件、脚本语言代码、宏代码、寄生在文件和启动扇区的指令流。 2. 恶意代码类型计算机病">
<meta property="og:type" content="article">
<meta property="og:title" content="恶意代码">
<meta property="og:url" content="http://icecream102.github.io/2022/11/08/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/index.html">
<meta property="og:site_name" content="Luanne">
<meta property="og:description" content="[TOC] 一、基础知识1. 恶意代码定义malware is a set of instructions that run on your computer and make your system do something that an attacker wants it to do. 指令集合：二进制执行文件、脚本语言代码、宏代码、寄生在文件和启动扇区的指令流。 2. 恶意代码类型计算机病">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-07T20:02:47.000Z">
<meta property="article:modified_time" content="2022-11-07T07:03:30.183Z">
<meta property="article:author" content="Luanne">
<meta property="article:tag" content="网络安全 恶意代码">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Luanne" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Luanne</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://Icecream102.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-恶意代码" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/11/08/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/" class="article-date">
  <time class="dt-published" datetime="2022-11-07T20:02:47.000Z" itemprop="datePublished">2022-11-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      恶意代码
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h1 id="一、基础知识"><a href="#一、基础知识" class="headerlink" title="一、基础知识"></a>一、基础知识</h1><h2 id="1-恶意代码定义"><a href="#1-恶意代码定义" class="headerlink" title="1. 恶意代码定义"></a>1. 恶意代码定义</h2><p><strong>malware</strong> is <strong>a set of instructions</strong> that run on your computer and make your system do something that <strong>an attacker wants it to do</strong>.</p>
<p>指令集合：二进制执行文件、脚本语言代码、宏代码、寄生在文件和启动扇区的指令流。</p>
<h2 id="2-恶意代码类型"><a href="#2-恶意代码类型" class="headerlink" title="2. 恶意代码类型"></a>2. 恶意代码类型</h2><h3 id="计算机病毒（Virus）"><a href="#计算机病毒（Virus）" class="headerlink" title="计算机病毒（Virus）"></a>计算机病毒（Virus）</h3><p>通过感染文件（可执行文件、数据文件、电子邮件…）或磁盘引导扇区进行传播，一般需要宿主程序被执行或人为交互才能运行。<br>e.g. Brain  Concept  CIH  勒索软件</p>
<h3 id="蠕虫（Worm）"><a href="#蠕虫（Worm）" class="headerlink" title="蠕虫（Worm）"></a>蠕虫（Worm）</h3><p>一般不需要宿主的单独文件，通过网络传播，自动复制，通常无需认为交互便可感染传播。<br>e.g. Morris  CodeRed  Slammer</p>
<h3 id="启动器（Downloader）"><a href="#启动器（Downloader）" class="headerlink" title="启动器（Downloader）"></a>启动器（Downloader）</h3><p>从远程主机下载到本地执行的轻量级恶意代码，不需要或仅需要极少的人为干预。代表性的开发工具由：JavaScript  VBScript  ActiveX  启动其他恶意程序的恶意代码<br>e.g. SantyWorm</p>
<h3 id="后门（Backdoor）"><a href="#后门（Backdoor）" class="headerlink" title="后门（Backdoor）"></a>后门（Backdoor）</h3><p>绕过正常的安全控制机制，从而为攻击者提供访问途径。<br>e.g. Netcat  BO  冰河  Glupteba</p>
<h3 id="特洛伊木马（Trojan）"><a href="#特洛伊木马（Trojan）" class="headerlink" title="特洛伊木马（Trojan）"></a>特洛伊木马（Trojan）</h3><p>伪装成有用软件，隐藏其恶意目标，欺骗用户安装执行。<br>e.g. Setiri  Emotet  Dridex  Ramnit</p>
<h3 id="僵尸程序（Bot）"><a href="#僵尸程序（Bot）" class="headerlink" title="僵尸程序（Bot）"></a>僵尸程序（Bot）</h3><p>一般不需要宿主的单独文件，通过网络传播，自动复制，通常无需人为交互便可感染传播，使用一对多的命令与控制机组成僵尸网络。<br>e.g. Sdbot  Agobot  Mirai  Glupteba</p>
<h3 id="内核套件（Rootkit）"><a href="#内核套件（Rootkit）" class="headerlink" title="内核套件（Rootkit）"></a>内核套件（Rootkit）</h3><p>通过替换或修改系统关键可执行文件（用户态），或者通过控制OS内核（内核态），用以获取并保持最高控制权（root access）<br>e.g. LRK FU hdef</p>
<h3 id="融合型恶意代码及Bootkit（固件感染）"><a href="#融合型恶意代码及Bootkit（固件感染）" class="headerlink" title="融合型恶意代码及Bootkit（固件感染）"></a>融合型恶意代码及Bootkit（固件感染）</h3><p>融合上述多种恶意代码技术，构成更具破坏性的恶意代码形态，如Bootkit<br>e.g. Nimda  Stuxnet  Flame  Duqu</p>
<h2 id="3-恶意代码分析方法"><a href="#3-恶意代码分析方法" class="headerlink" title="3. 恶意代码分析方法"></a>3. 恶意代码分析方法</h2><h3 id="静态分析"><a href="#静态分析" class="headerlink" title="静态分析"></a>静态分析</h3><p>通过<strong>反病毒引擎</strong>扫描识别已知的恶意代码家族和变种名；<br>逆向分析恶意代码模块构成，内部数据结构，关键控制流程等，理解恶意代码的机理，并提取特征码用于检测；</p>
<ul>
<li>恶意代码扫描：标识已知恶意代码（反病毒引擎、VirusTotal）</li>
<li>文件格式识别：确定攻击平台和类型（file, peid, FileAnalyze）</li>
<li>字符串提取：寻找恶意代码分析线索（strings）</li>
<li>二进制结构分析：初步了解二进制文件结构（binutils）</li>
<li>反汇编：二进制代码-&gt;汇编代码（IDAPro, GDB, VC）</li>
<li>反编译：汇编代码-&gt;高级语言（REC, DCC, JAD）</li>
<li>代码结构与逻辑分析：分析二进制代码组，理解二进制代码逻辑结构（IDAPro, Ollydbg）</li>
<li>加壳结构和代码脱壳：识别是否加壳及类型；对抗代码混淆恢复原始代码（UPX, VMUnpacker，手工）</li>
</ul>
<h3 id="动态分析"><a href="#动态分析" class="headerlink" title="动态分析"></a>动态分析</h3><p>通过受控环境中执行目标代码，以获取目标代码的行为及运行结果；</p>
<ul>
<li>快照对比：获取恶意代码行为结果（FileSnap, RegSnap, 完美卸载）</li>
<li>动态行为监控：实时监控恶意代码动态行为轨迹（Filemon, Regmon, ProcessExploer, Isof）</li>
<li>网络监控：分析恶意代码网络监听端口及发起网络会话（Fport, Isof, TDImon, ifconfig, tcpdump）</li>
<li>沙盒：在受控环境下进行完整的恶意代码动态行为监控和分析（NormanSandbox, CWSandbox, FVMSandbox）</li>
<li>动态跟踪调试：单步调试恶意代码程序，理解程序结构和逻辑（Ollydbg, IDAPro, gdb, softICE, systrace）</li>
</ul>
<h2 id="4-恶意代码分析目标"><a href="#4-恶意代码分析目标" class="headerlink" title="4. 恶意代码分析目标"></a>4. 恶意代码分析目标</h2><p>为网络入侵事件的响应提供所需信息；<br>确定到底发生了什么；<br>确保定位出所有受感染的主机和文件；<br>确定恶意代码可以做什么；<br>分析出主机特征和网络特征，以便检测；</p>
<h1 id="二、静态分析基础技术"><a href="#二、静态分析基础技术" class="headerlink" title="二、静态分析基础技术"></a>二、静态分析基础技术</h1><h2 id="1-恶意代码的扫描"><a href="#1-恶意代码的扫描" class="headerlink" title="1. 恶意代码的扫描"></a>1. 恶意代码的扫描</h2><p>使用反病毒软件进行检测；<br>开源恶意代码扫描引擎ClamAV；<br>从反病毒厂商获得已知恶意代码的分析报告和结果；</p>
<h2 id="2-哈希值：恶意代码的指纹"><a href="#2-哈希值：恶意代码的指纹" class="headerlink" title="2. 哈希值：恶意代码的指纹"></a>2. 哈希值：恶意代码的指纹</h2><p>将哈希值作为标签使用；<br>与其他分析师分享哈希值，以帮助他们来识别恶意代码；<br>在线搜索这段哈希值，查看这个文件是否已被识别；<br>（MD5算法不再被用于任何软件完整性检查或代码签名）</p>
<h2 id="3-查找字符串"><a href="#3-查找字符串" class="headerlink" title="3. 查找字符串"></a>3. 查找字符串</h2><p>可能获得的有用信息：<br>恶意代码实例名<br>帮助或命令行选项<br>用户会话<br>后门口令<br>相关URL信息、EMAIL地址<br>库、函数调用</p>
<h2 id="4-加壳和混淆恶意代码"><a href="#4-加壳和混淆恶意代码" class="headerlink" title="4. 加壳和混淆恶意代码"></a>4. 加壳和混淆恶意代码</h2><p>可执行程序源文件（字符串列表与其他信息是可见的）；<br>脱壳器程序 + 加壳后可执行程序（字符串列表与其他信息都不可见）；</p>
<p><strong>壳</strong>出于程序作者想对程序资源<strong>压缩</strong>、注册<strong>保护</strong>的目的，把壳主要分为<strong>压缩壳、加密壳</strong>；</p>
<ul>
<li>压缩壳：减小程序体积对资源进行压缩（RAR ZIP 7Z FSG ASPack UPX 北斗）</li>
<li>加密壳：保护壳、猛壳，对程序输入表等内容进行加密保护，具有良好的保护效果（ASPORTECT ACPROTECT PELock 幻影 VMProtect）</li>
</ul>
<h2 id="5-PE文件格式"><a href="#5-PE文件格式" class="headerlink" title="5. PE文件格式"></a>5. PE文件格式</h2><p>PE（Portable Execute）文件是Windows下可执行文件的总成，常见的有DLL EXE OCX SYS；<br>PE是指32位可执行文件，64位可执行文件是PE+或PE32+；<br>PE文件以一个文件头开始，其中包括代码信息、应用程序类型、所需的库函数和空间要求</p>
<h2 id="6-链接库和函数"><a href="#6-链接库和函数" class="headerlink" title="6. 链接库和函数"></a>6. 链接库和函数</h2><p>导入函数（引入函数）：被该模块调用，但它不在该模块中，调用模块中只包含该函数的一些信息（函数名和其所在的模块（链接库）名等）；</p>
<p>导入表：导入函数相关信息都保存在PE文件中的导入表中，要找到PE文件的导入表，必须先找到data directory即数据目录；</p>
<p><strong>静态链接</strong><br>在生成可执行程序时，就把库中的内容加入到程序中，在<strong>程序运行前</strong>，先将其目标模块及它们所需的库函数，链接成一个完整的装配模块，以后不再拆开的链接方式；</p>
<p><strong>动态链接</strong><br>用户源程序编译后得到一组目标模块，在装入内存时采用<strong>边装入边链接</strong>。装入一个目标模块时，若发生一个外部模块调用，将引起装入程序去找出相应的外部目标模块，并将它装入内存，还要修改目标模块中的相对地址；</p>
<p><strong>运行时链接</strong><br>有些目标模块的链接，推迟到<strong>执行时</strong>才进行，即在执行过程中，若发现一个被调用模块尚未装入内存时，由OS去找到该模块，将它装入内存，并把它连接到调用者模块上，对某些目标模块的链接，是在程序执行中需要该目标模块时，才对它进行的链接；</p>
<p><strong>导入函数</strong><br>PE文件头包含可执行文件使用的特定函数相关信息；<br>导入函数描述可执行文件会使用哪些Windows API函数，也就是可能会有什么样的操作；</p>
<p><strong>导出函数</strong><br>用来与其他程序和代码进行交互时所使用的；<br>一个DLL会出现一个或多个功能函数，然后将其导出，供别的程序导入并使用；</p>
<h2 id="7-PE文件头与节"><a href="#7-PE文件头与节" class="headerlink" title="7. PE文件头与节"></a>7. PE文件头与节</h2><p>PE文件的全称是Portable Executable，意为可移植的可执行的文件，常见的EXE、DLL、OCX、SYS、COM都是PE文件，PE文件是微软Windows操作系统上的程序文件（可能是间接被执行，如DLL）</p>
<p><strong>.text</strong><br>包含CPU执行指令，所有其他节存储数据和支持性的信息，一般来说这是唯一可以执行的节，也是唯一包含代码的节；</p>
<p><strong>.rdata</strong><br>包含导入与导出函数信息，还可以存储程序所使用的其他制度数据</p>
<p><strong>.data</strong><br>包含程序的全局数据，可以从程序的任何地方访问到。本地数据并不存储在这个节，而是在PE文件的某个其他位置上；</p>
<p><strong>.rsrc</strong><br>包含由可执行文件所使用的资源，不能执行，如图标、图片、菜单项、字符串等，字符串也可以存储在主程序中，存放在这是为提供多语种支持；</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://icecream102.github.io/2022/11/08/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/" data-id="cla6fv9je00037cu08d1edtho" data-title="恶意代码" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8-%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/" rel="tag">网络安全 恶意代码</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2022/11/08/XSS/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">XSS</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81-%E9%80%86%E5%90%91/" rel="tag">恶意代码 逆向</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8-XSS/" rel="tag">网络安全 XSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8-%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/" rel="tag">网络安全 恶意代码</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81-%E9%80%86%E5%90%91/" style="font-size: 10px;">恶意代码 逆向</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8-XSS/" style="font-size: 10px;">网络安全 XSS</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8-%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/" style="font-size: 10px;">网络安全 恶意代码</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/11/08/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/">恶意代码</a>
          </li>
        
          <li>
            <a href="/2022/11/08/XSS/">XSS</a>
          </li>
        
          <li>
            <a href="/2022/10/26/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98Lab3-3/">恶意代码分析实战 Lab3_3</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 Luanne<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>